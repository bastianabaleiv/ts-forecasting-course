---
title: "Clase 3"
description: |
  Series de tiempo en R: evaluando modelos basados en caracter铆sticas
author:
  - name: Basti谩n Aballay L.
    url: https://www.linkedin.com/in/bastianaballay/
date: "2021-11-08"
bibliography: clase-03.bib
output:
  distill::distill_article:
    toc: true
    toc_depth: 2
    toc_float: true
    code_folding: true
    highlight: tango
    self_contained: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

En la [Clase 2](posts/clase-01) revisamos los aspectos te贸ricos b谩sicos
que nos permiten caracterizar a las series de tiempo.

En esta clase revisaremos las series de tiempo desde una perspectiva pr谩ctica,
estableciendo los requerimientos necesarios para lograr manipularlas, agregarlas y
pronosticarlas usando ecosistemas de `R`. Luego de esta clase podr谩s:

+ Conocer los requerimientos t茅cnicos (*packages*) para trabajar con series de tiempo en `R`
+ Manipular y agregar series de tiempo
+ Entender el proceso de evaluaci贸n de pron贸sticos a trav茅s del tiempo
+ Definir indicadores de desempe帽o adecuados para evaluar modelos de pron贸stico
+ Entender la importancia de establecer una modelo ingenuo como pron贸stico inicial
+ Generar caracter铆sticas para modelos de pron贸stico a partir del 铆ndice temporal asociado a la serie
+ Modelar series de tiempo utilizando el Regresi贸n Lineal 


# Objetos de R para Series de Tiempo



# Evaluaci贸n de pron贸sticos

## Set de entrenamiento y test

La precisi贸n de un pron贸stico s贸lo puede ser determinada considerando qu茅 tan 
bien se desempe帽an los pron贸sticos generados en datos nuevos que no han sido 
utilizados para ajustar el modelo (@Hyndman2021-hc). As铆, al igual que como
se eval煤an los modelos de Machine Learning, es una pr谩ctica com煤n separar
los datos disponibles en dos conjuntos, un conjunto de ajuste o *entrenamiento*
(*training set*)^[a.k.a. *in-sample data*] y otro de evaluaci贸n 
(*test set*)^[a.k.a. *out-sample data*, *hold-out set*], 
donde los datos de entrenamiento son utilizados para estimar los par谩metros de cualquier 
m茅todo de pron贸stico y los datos de evaluaci贸n son utilizados para determinar su precisi贸n. 
Dado que los datos de evaluaci贸n no son utilizados en el proceso de elaboraci贸n
de los pron贸sticos, 茅stos nos permiten obtener un indicador confiable de qu茅 tan
bien puede pronosticar un modelo los datos nuevos. 

<aside>
<p>Training Set</p>
<p>Test Set</p>
</aside>

Al momento de evaluar el desempe帽o de modelos de pron贸stico es necesario
distinguir entre un *pron贸stico* (*forecast*) o *valor predicho* (*predicted value*)
de $y_t$, realizado en alg煤n per铆odo previo, por ejemplo $t-\tau$, y un
*valor ajustado* (*fitted value*) de $y_t$, que ha resultado de estimar los par谩metros
de un modelo de series de tiempo en datos hist贸ricos, generando *residuales*.

El m茅todo m谩s com煤n para evaluar el 茅xito de un pron贸stico para predecir los valores
reales es utilizar m茅tricas de precisi贸n o error. Aqu铆 *error* no debe entenderse
como una equivocaci贸n, sino como la parte impredecible de una observaci贸n.
La selecci贸n de la m茅trica espec铆fica de error depender谩 de los objetivos de 
pron贸stico de que se tengan.

<aside>
Error de pron贸stico
</aside>

El tama帽o del set de evaluaci贸n depende de qu茅 tanta informaci贸n se posea y qu茅
tan adelante se quiera pronosticar. Es ideal que el test set tenga al menos
el largo del horizonte de pron贸stico m谩ximo requerido.

Algunas observaciones a considerar

+ Un modelo que se ajusta bien a los datos de entrenamiento no necesariamente
pronosticar谩 bien.
+ Siempre es posible obtener un ajuste perfecto usando un modelo con una cantidad
de par谩metros suficiente^[Por ejemplo, redes neuronales]
+ *Sobreajustarse* (*over-fit*) un modelo a los datos es tan malo como fallar en
identificar los patrones sistem谩ticos en ellos.

## Validaci贸n Cruzada para Series de Tiempo (TSCV)

Mencionar revisi贸n de [TSCV](posts/clase-01/index.html#forecastingprocess) 
en clase 01.

## Modelos benchmark (naive)

## An谩lisis de residuales

## M茅tricas de desempe帽o 

### MAE

En el *error absoluto medio* (*Mean Absolute Error* (MAE)), el error de pron贸stico
est谩 en la misma escala que los datos originales. Debido a lo anterior, no puede
ser utilizado para comparar desempe帽o entre series que involucren distintas unidades
de medida. Un m茅todo de pron贸stico que minimice el MAE conducir谩 a pronosticos
de la mediana. Este m茅todo no es sensible a outliers.

$$MAE = \frac{1}{T}\sum_{t=1}^{T}\left|y_{t}-\hat{y}_{t}\right|$$

### MSE

El error cuadr谩tico medio (*Mean Squared Error* (MSE)) cuantifica la distancia al 
cuadrado promedio entre los valores reales y los pronosticados. 
El efecto de elevar al cuadrado previene que los valores negativos
y positivos se cancelen entre s铆, penalizando el error si es muy elevado.
Un m茅todo de pron贸stico que minimice el MSE conducir谩 a pronosticos
de la media.

$$MSE = \frac{1}{T}\sum_{t=1}^{T}(y_t - \hat{y}_t)^2$$

### RMSE

Similar a MSE, en las unidades de las observaciones.

$$RMSE = \sqrt{MSE} = \sqrt{\frac{1}{T}\sum_{t=1}^{T}(y_t - \hat{y}_t)^2}$$

### MAPE

El error porcentual absoluto medio (*Mean Absolute Percentage Error* (MAPE)) es una
de las m茅tricas m谩s f谩ciles de comparar y comunicar con interlocutores no-t茅cnicos
dado que representa un porcentaje. Los errores porcentuales poseen la ventaja de 
no tener unidades y son utilizados para comparar el desempe帽o de un modelo
de pron贸stico entre datasets. Sin embargo, poseen la desventaja de ser infintos
o indefinidos si $y_t = 0$ para cualquier periodo de inter茅s $t$, adem谩s de tener
valores extremos cuando $y_t$ es cercano a cero. Adem谩s, poseen la desventaja
de penalizar errores negativos m谩s que los positivos, lo que condujo a la 
elaboraci贸n de otra m茅trica porcentual llamada sMAPE (*symmetric MAPE*), usado
en la competencia M3.

$$MAPE = \frac{1}{T}\sum _{t=1}^{T}\bigg(\frac{|y_{t}-\hat{y}_{t}|}{y_{t}}\bigg)\times100$$

### SMAPE

$$SMAPE = {\frac{1}{T}\sum _{t=1}^{T}\bigg(\frac{2|y_{t}\hat{y}_{t}|}{y_{t}+\hat{y}_{t}}\bigg)\times 100}$$ 


### $R^{2}$

$$R^{2} = {1-{\frac {\sum _{t=1}^{T}\left(y_{t}-\hat{y}_{t}\right)}{\sum _{i=1}^{T}\left(y_{t}-\bar{y}_{t}\right)}}}$$

## Evaluaci贸n de desempe帽o en R 

Podemos encontrar las m茅tricas revisadas anteriormente en los siguientes
paquetes:

+ [`Metrics`](https://cran.r-project.org/web/packages/Metrics/index.html)
+ [`yardstick`](https://yardstick.tidymodels.org/) 

# Regresi贸n Lineal para pron贸stico de series de tiempo


